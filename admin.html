<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>ğŸ“Š ê´€ë¦¬ì í˜ì´ì§€</h2>
  <input id="school" placeholder="í•™êµëª…">
  <input id="grade" placeholder="í•™ë…„ (ì„ íƒ)">
  <input id="class" placeholder="ë°˜ (ì„ íƒ)">
  <button onclick="loadData()">ì¡°íšŒ</button>
  <div id="results"></div>

  <script>
    function loadData() {
      const school = document.getElementById("school").value.trim();
      const grade = document.getElementById("grade").value.trim();
      const classNum = document.getElementById("class").value.trim();

      if (!school) {
        alert("í•™êµëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      const query = new URLSearchParams({
        type: "admin",
        school,
        grade,
        class: classNum
      });

      fetch(`https://script.google.com/macros/s/ì›¹ì•±ì£¼ì†Œ/exec?${query.toString()}`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("results");
          container.innerHTML = `<h3>ì¡°íšŒ ê²°ê³¼: ${data.length}ê±´</h3>`;
          if (!data.length) {
            container.innerHTML += "<p>í•´ë‹¹ ì¡°ê±´ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          const grouped = {};
          data.forEach(row => {
            const key = `${row.grade}í•™ë…„ ${row.class}ë°˜`;
            if (!grouped[key]) grouped[key] = [];
            grouped[key].push(row);
          });

          for (let group in grouped) {
            const section = document.createElement("div");
            section.innerHTML = `<h4>ğŸ“˜ ${group}</h4>`;
            grouped[group].forEach(row => {
              section.innerHTML += `
                <div class="card">
                  <p><strong>${row.number}ë²ˆ ${row.name}</strong></p>
                  <p><strong>ë‹¨ê³„:</strong> ${row.stage}</p>
                  <p><strong>ì œëª©:</strong> ${row.title}</p>
                  <p>${row.content}</p>
                  <p style="font-size: 0.8em; color: gray;">ğŸ•’ ${row.time}</p>
                </div>
              `;
            });
            container.appendChild(section);
          }
        });
    }
  </script>
</body>
</html>
